<!DOCTYPE html>
<html>
    <head>
        <title>Craft Pattern Designer</title>
        <style>
            body{
                font-family:arial;
            }
            .cell{
                position:relative;
                display:inline-block;
                border:1px solid black;
            }
            #settings{
                float:left;
                margin-right:100px;
            }
            #gridArea{
                overflow-x: scroll;
                white-space:nowrap;
                display:block;
                font-size:0;
            }
            .row{
                font-size:0;
                clear:left;
                white-space:nowrap;
                display:block;
            }
        </style>
        <script src="jscolor.min.js"></script>
    </head>
    <body onload="initialiseVariables()">
        <div id="settings">
        Overwrite Colours on drag:<input type="checkbox" id="overwrite-on-drag" onclick="updateOverwriteOnDrag()" /><br /><br />
        Overwrite Colours on click:<input type="checkbox" id="overwrite-on-click" onclick="updateOverwriteOnClick()" checked="true" /><br /><br />
        Eraser Mode:<input type="checkbox" id="is-eraser-mode" onclick = "updateEraserMode()"/><br /><br />
        Cell Size:<input type="number" id="cell-size" value="40" /><br /><br />
        Columns:<input type="number" id="columns" value="6" /><br /><br />
        Rows:<input type="number" id="rows" value="6" /><br /><br />
        <button class="jsColor { styleElement:'cellColor', valueElement: 'cellColor',value:'FF0000'}">Colour</button>
        Cell Colour:<span id="cellColor"></span><br /><br />
        <button onclick="generateGrid()">Generate Grid</button><br /><br />
        <button onClick="clearColours()">Clear Colours</button><br /><br />
        </div>
        <div id="gridArea">
        </div>
        <script>
            var mouseState;
            var isEraserMode;
            var isOverwriteOnClickEnabled;
            var isOverwriteOnDragEnabled;
            var newColor;

            document.onmousedown = function() {
                mouseState = "mousedown";
            };

            document.onmouseup = function() {
                mouseState = "mouseup";
            };

            function initialiseVariables() {
                isOverwriteOnDragEnabled = document.getElementById("overwrite-on-drag").checked;
                isOverwriteOnClickEnabled = document.getElementById("overwrite-on-click").checked;
                isEraserMode = document.getElementById("is-eraser-mode").checked;
                generateGrid();
            }

            function generateGrid() {
                var gridArea = document.getElementById("gridArea"); 
                gridArea.innerHTML="";
                var columns = document.getElementById("columns").value;
                var rows = document.getElementById("rows").value;
                var cellSize = document.getElementById("cell-size").value;
                for (var i = 0; i < rows; i++) {
                    gridArea.innerHTML += "<div class=\"row\">";
                    for (var j = 0; j < columns; j++) {
                        gridArea.innerHTML += "<div id=\"r" + i + "c" + j + "\" class=\"cell\" style=\"background-color:white;width:" + cellSize + "px;height:" + cellSize + "px;\""+
                                              "onmousedown=\"changeColourOnMouseDown(this)\" onmouseover=\"changeColourOnHover(this)\">"; 
                    }
                    gridArea.innerHTML += "</div>";
                }
            }

            function updateOverwriteOnDrag() {
                isOverwriteOnDragEnabled = document.getElementById("overwrite-on-drag").checked;
            }

            function updateEraserMode() {
                isEraserMode = document.getElementById("is-eraser-mode").checked;
            }

            function updateOverwriteOnClick() {
                isOverwriteOnClickEnabled = document.getElementById("overwrite-on-click").checked;
            }

            function changeColourOnHover(cell){
                if (mouseState == "mousedown"){
                    if (isEraserMode) {
                        cell.style.backgroundColor = "white";
                    } else if (isOverwriteOnDragEnabled || cell.style.backgroundColor == "white") {
                        cell.style.backgroundColor = document.getElementById("cellColor").style.backgroundColor;
                    }
                }
            }

            function changeColourOnMouseDown(cell) {
                if (isEraserMode) {
                    cell.style.backgroundColor = "white";
                } else if (isOverwriteOnClickEnabled || cell.style.backgroundColor == "white") {
                    cell.style.backgroundColor = document.getElementById("cellColor").style.backgroundColor;
                } else {
                    console.log("wah");
                }
            }

            function clearColours() {
                var cells = document.getElementsByClassName("cell");
                for (var i = 0; i < cells.length; i++){
                    cells.item(i).style.backgroundColor = "white";
                }
            }
        </script>
    </body>
</html>
